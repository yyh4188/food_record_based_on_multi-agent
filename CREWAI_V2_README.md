# CrewAI V2 - çœŸæ­£çš„ CrewAI æ¡†æ¶é›†æˆ

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### ä¹‹å‰çš„ç‰ˆæœ¬ï¼ˆV1ï¼‰
- âœ— åªæ˜¯æŠŠ CrewAI å½“"å£³"ï¼ŒAgent ä¸»è¦é  LLM è‡ªç”±å‘æŒ¥
- âœ— BaseAgent çš„ä¸šåŠ¡é€»è¾‘ï¼ˆprocessæ–¹æ³•ï¼‰æ²¡è¢«çœŸæ­£è°ƒç”¨
- âœ— æ²¡æœ‰æ˜¾å¼çš„å¤šæ­¥åä½œæµç¨‹
- âœ— Agent ä¹‹é—´ç¼ºå°‘äº¤å‰æ ¡éªŒ

### ç°åœ¨çš„ç‰ˆæœ¬ï¼ˆV2ï¼‰
- âœ“ **çœŸæ­£çš„ CrewAI æ¡†æ¶**ï¼šAgent + Task + Crew + Tools
- âœ“ **ä¸šåŠ¡å·¥å…·é›†æˆ**ï¼šæ¯ä¸ª BaseAgent.process() è¢«åŒ…è£…æˆ CrewAI tool
- âœ“ **å¤šæ­¥å·¥ä½œæµ**ï¼šTask ä¾èµ–é“¾ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œ
- âœ“ **æ˜¾å¼æ ¡éªŒ**ï¼šAgent ä¹‹é—´äº’ç›¸åˆ¶çº¦å’ŒéªŒè¯
- âœ“ **æå‡å‡†ç¡®ç‡**ï¼šè§„åˆ™é€»è¾‘ + LLM æ¨ç†åŒé‡ä¿éšœ

---

## ğŸ“ å…³é”®æ–‡ä»¶

### 1. `utils/crewai_tools.py`
æŠŠ BaseAgent çš„ä¸šåŠ¡é€»è¾‘åŒ…è£…æˆ CrewAI toolsï¼š

```python
# ä¾‹å¦‚ HealthGoalAgent çš„å·¥å…·
@tool("åˆ†æå¥åº·ç›®æ ‡è¿›åº¦")
def analyze_health_progress(input_data: Dict) -> Dict:
    result = self.base_agent.process(input_data)  # è°ƒç”¨ä¸šåŠ¡é€»è¾‘
    return result

@tool("éªŒè¯ç›®æ ‡å®‰å…¨æ€§")
def validate_goal_safety(current_weight, target_weight, days) -> Dict:
    # è§„åˆ™åˆ¤æ–­ï¼šå‡é‡é€Ÿåº¦æ˜¯å¦å®‰å…¨
    ...
```

### 2. `utils/crewai_adapter_v2.py`
åˆ›å»º Agent æ—¶æŒ‚è½½å·¥å…·ï¼š

```python
class CrewAIAgentAdapter:
    def __init__(self, base_agent, role, goal, backstory, enable_tools=True):
        # åˆ›å»ºå·¥å…·
        tools = create_agent_tools(base_agent)
        
        # åˆ›å»º Agentï¼ˆå¸¦å·¥å…·ï¼‰
        self.crew_agent = Agent(
            role=role,
            goal=goal,
            backstory=backstory,
            llm=self.llm,
            tools=tools,  # ğŸ”§ å…³é”®ï¼šæŒ‚è½½ä¸šåŠ¡å·¥å…·
            verbose=True,
            allow_delegation=True,
            memory=True
        )
```

### 3. `api/crewai_api_v2.py`
å®ç°çœŸæ­£çš„å¤šæ­¥åä½œæµç¨‹ï¼š

```python
def create_weight_loss_workflow(crew, adapters, user_input):
    # Task 1: å¥åº·ç›®æ ‡å®‰å…¨æ€§éªŒè¯
    task1 = adapters['health'].create_task(
        description="éªŒè¯å‡è„‚ç›®æ ‡çš„å®‰å…¨æ€§...",
        expected_output="å®‰å…¨æ€§è¯„ä¼°æŠ¥å‘Š"
    )
    
    # Task 2: è¥å…»çº¦æŸåˆ†æï¼ˆä¾èµ– Task 1ï¼‰
    task2 = adapters['nutrition'].create_task(
        description="åŸºäºå®‰å…¨éªŒè¯ç»“æœï¼Œåˆ†æè¥å…»çº¦æŸ...",
        expected_output="è¥å…»çº¦æŸæŠ¥å‘Š",
        context=[task1]  # ä¾èµ– Task 1
    )
    
    # Task 3: ç”Ÿæˆé¥®é£Ÿè®¡åˆ’ï¼ˆä¾èµ– Task 1+2ï¼‰
    task3 = adapters['meal'].create_task(
        description="æ ¹æ®å‰ä¸¤æ­¥çº¦æŸï¼Œç”Ÿæˆé¥®é£Ÿè®¡åˆ’...",
        expected_output="ç»è¿‡éªŒè¯çš„é¥®é£Ÿè®¡åˆ’",
        context=[task1, task2]
    )
    
    # ... æ›´å¤š Task
    
    return [task1, task2, task3, ...]
```

---

## ğŸ”„ å·¥ä½œæµç¨‹ç¤ºä¾‹ï¼šå‡è„‚åœºæ™¯

### ç”¨æˆ·è¯·æ±‚
```json
POST /crewai/process
{
    "message": "æˆ‘æƒ³å‡è‚¥",
    "user_id": 1001,
    "context": {
        "current_weight": 75.0,
        "target_weight": 70.0,
        "days": 30,
        "target_calories": 1800,
        "dietary_preferences": ["é«˜è›‹ç™½", "ä½ç¢³æ°´"],
        "restrictions": ["ä¸åƒè¾£"]
    }
}
```

### å†…éƒ¨æ‰§è¡Œæµç¨‹

```
ğŸ“¥ è¯·æ±‚åˆ°è¾¾ /crewai/process

ğŸ“Š åœºæ™¯è¯†åˆ«: weight_loss

ğŸ”„ åˆ›å»º 5 ä¸ª Task å·¥ä½œæµ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task 1: å¥åº·ç›®æ ‡å®‰å…¨æ€§éªŒè¯ (HealthGoalAgent)                â”‚
â”‚ â”œâ”€ è°ƒç”¨å·¥å…·: validate_goal_safety()                         â”‚
â”‚ â”œâ”€ è¾“å…¥: current=75kg, target=70kg, days=30                 â”‚
â”‚ â”œâ”€ è§„åˆ™åˆ¤æ–­: æ¯å¤©å‡é‡ 0.17kgï¼Œæ˜¯å¦å®‰å…¨ï¼Ÿ                    â”‚
â”‚ â””â”€ è¾“å‡º: âœ“ å®‰å…¨ï¼Œé£é™©ç­‰çº§: æ­£å¸¸                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task 2: è¥å…»çº¦æŸåˆ†æ (NutritionAnalyzerAgent)               â”‚
â”‚ â”œâ”€ ä¾èµ–: Task 1 çš„ç»“æœ                                       â”‚
â”‚ â”œâ”€ è°ƒç”¨å·¥å…·: validate_nutrition_balance()                   â”‚
â”‚ â”œâ”€ è¾“å…¥: target_calories=1800                               â”‚
â”‚ â”œâ”€ éªŒè¯: çƒ­é‡ã€è›‹ç™½è´¨ã€ç¢³æ°´ã€è„‚è‚ªæ˜¯å¦åœ¨å®‰å…¨èŒƒå›´             â”‚
â”‚ â””â”€ è¾“å‡º: âœ“ è¥å…»é…æ¯”åˆç†                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task 3: ç”Ÿæˆé¥®é£Ÿè®¡åˆ’ (MealPlannerAgent)                     â”‚
â”‚ â”œâ”€ ä¾èµ–: Task 1 + Task 2 çš„çº¦æŸ                             â”‚
â”‚ â”œâ”€ è°ƒç”¨å·¥å…·: generate_meal_plan()                           â”‚
â”‚ â”œâ”€ ç”Ÿæˆ: 30å¤©çš„ä¸‰é¤è®¡åˆ’                                      â”‚
â”‚ â”œâ”€ è‡ªæ£€: validate_meal_plan()                               â”‚
â”‚ â”‚   â””â”€ éªŒè¯æ¯å¤©çƒ­é‡æ˜¯å¦åœ¨ 1800Â±10%                          â”‚
â”‚ â””â”€ è¾“å‡º: âœ“ éªŒè¯é€šè¿‡çš„é¥®é£Ÿè®¡åˆ’                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task 4: è¿›åº¦è·Ÿè¸ªæ–¹æ¡ˆ (HealthGoalAgent)                      â”‚
â”‚ â”œâ”€ ä¾èµ–: Task 3 çš„é¥®é£Ÿè®¡åˆ’                                   â”‚
â”‚ â”œâ”€ è°ƒç”¨å·¥å…·: analyze_health_progress()                      â”‚
â”‚ â””â”€ è¾“å‡º: é‡Œç¨‹ç¢‘ã€æ£€æŸ¥ç‚¹ã€æ¿€åŠ±å»ºè®®                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task 5: ç»¼åˆæ€»ç»“ (ConversationAgent - Manager)              â”‚
â”‚ â”œâ”€ ä¾èµ–: å‰é¢ 4 ä¸ª Task çš„æ‰€æœ‰ç»“æœ                          â”‚
â”‚ â”œâ”€ ä¸è°ƒç”¨å·¥å…·ï¼ˆçº¯ LLMï¼‰                                      â”‚
â”‚ â””â”€ è¾“å‡º: ç”¨æˆ·å‹å¥½çš„å®Œæ•´å‡è„‚æ–¹æ¡ˆ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… è¿”å›æœ€ç»ˆç»“æœ
```

---

## ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·èƒ½æå‡å‡†ç¡®ç‡ï¼Ÿ

### 1. ä¸“ä¸šåˆ†å·¥
æ¯ä¸ª Agent åªè´Ÿè´£è‡ªå·±æ“…é•¿çš„ï¼š
- HealthGoalAgent: åªçœ‹ç›®æ ‡åˆç†æ€§
- NutritionAnalyzerAgent: åªçœ‹è¥å…»å¹³è¡¡
- MealPlannerAgent: åªæ’é¤

### 2. å¤šè§†è§’æ ¡éªŒ
- HealthGoalAgent è¯´"è¿™ä¸ªç›®æ ‡ä¸å®‰å…¨" â†’ MealPlanner å¿…é¡»è°ƒæ•´
- NutritionAnalyzer è¯´"è›‹ç™½è´¨ä¸å¤Ÿ" â†’ MealPlanner å¿…é¡»å¢åŠ é«˜è›‹ç™½é£Ÿæ
- MealPlanner ç”Ÿæˆè®¡åˆ’åï¼Œè‡ªå·±å†ç”¨å·¥å…·éªŒè¯ä¸€é

### 3. è§„åˆ™ + LLM åŒä¿é™©
- **è§„åˆ™**ï¼šç¡¬çº¦æŸï¼ˆçƒ­é‡èŒƒå›´ã€å‡é‡é€Ÿåº¦ä¸Šé™ï¼‰
- **LLM**ï¼šè½¯è°ƒæ•´ï¼ˆå£å‘³åå¥½ã€è§£é‡Šè¯´æ˜ï¼‰
- å…³é”®æ•°æ®ç”±è§„åˆ™ä¿è¯ï¼Œè§£é‡Šç”± LLM ä¼˜åŒ–

### 4. æ˜¾å¼ä¾èµ–é“¾
- Task 2 å¿…é¡»ç­‰ Task 1 å®Œæˆ
- Task 3 å¿…é¡»å‚è€ƒ Task 1+2 çš„çº¦æŸ
- ä¸ä¼šå‡ºç°"åé¢æ­¥éª¤å¿½ç•¥å‰é¢ç»“è®º"çš„é—®é¢˜

---

## ğŸš€ å¦‚ä½•å¯åŠ¨

### å¯åŠ¨æœåŠ¡
```bash
# ä½¿ç”¨ V2 ç‰ˆæœ¬
python main_v2.py

# æˆ–è€…ç›´æ¥è¿è¡Œ API
python api/crewai_api_v2.py
```

### æŸ¥çœ‹ Crew ä¿¡æ¯
```bash
curl http://localhost:5001/crewai/crew-info
```

è¿”å›ï¼š
```json
{
    "success": true,
    "data": {
        "agents_count": 6,
        "agent_details": {
            "health": {
                "role": "å¥åº·ç›®æ ‡æ•™ç»ƒ",
                "tools_count": 2,  // âœ“ æœ‰å·¥å…·
                "has_tools": true
            },
            "nutrition": {
                "role": "è¥å…»åˆ†æå¸ˆ",
                "tools_count": 2,
                "has_tools": true
            },
            "meal": {
                "role": "é¥®é£Ÿè®¡åˆ’è®¾è®¡å¸ˆ",
                "tools_count": 2,
                "has_tools": true
            },
            "conversation": {
                "role": "å¥åº·å’¨è¯¢æ€»åè°ƒ",
                "tools_count": 0,  // âœ“ åè°ƒè€…ä¸éœ€è¦å·¥å…·
                "has_tools": false
            }
        },
        "features": [
            "çœŸæ­£çš„ CrewAI æ¡†æ¶",
            "ä¸šåŠ¡é€»è¾‘å·¥å…·é›†æˆ",
            "æ˜¾å¼å·¥å…·è°ƒç”¨",
            "å¤šæ­¥å·¥ä½œæµ",
            "äº¤å‰æ ¡éªŒ"
        ]
    }
}
```

### è°ƒç”¨å‡è„‚åœºæ™¯
```bash
curl -X POST http://localhost:5001/crewai/process \
  -H "Content-Type: application/json" \
  -d '{
    "message": "æˆ‘æƒ³å‡è‚¥",
    "user_id": 1001,
    "context": {
        "current_weight": 75.0,
        "target_weight": 70.0,
        "days": 30,
        "target_calories": 1800,
        "dietary_preferences": ["é«˜è›‹ç™½", "ä½ç¢³æ°´"]
    }
}'
```

---

## ğŸ“Š V1 vs V2 å¯¹æ¯”

| ç‰¹æ€§ | V1ï¼ˆæ—§ç‰ˆï¼‰ | V2ï¼ˆæ–°ç‰ˆï¼‰ |
|------|-----------|-----------|
| **CrewAI æ¡†æ¶** | âœ“ ä½¿ç”¨ Agent/Task/Crew | âœ“ ä½¿ç”¨ Agent/Task/Crew |
| **ä¸šåŠ¡å·¥å…·** | âœ— æ²¡æŒ‚è½½ | âœ“ æ¯ä¸ª Agent éƒ½æœ‰å·¥å…· |
| **å¤šæ­¥æµç¨‹** | âœ— åªæœ‰ä¸€ä¸ª Task | âœ“ 5æ­¥å·¥ä½œæµ + ä¾èµ–é“¾ |
| **æ˜¾å¼æ ¡éªŒ** | âœ— é  LLM è‡ªå·±å†³å®š | âœ“ ç¡¬ç¼–ç æ ¡éªŒé€»è¾‘ |
| **å‡†ç¡®ç‡** | ä¸­ç­‰ï¼ˆçº¯ LLM æ¨ç†ï¼‰ | é«˜ï¼ˆè§„åˆ™+LLM åŒä¿é™©ï¼‰ |
| **å¯æ§æ€§** | ä½ | é«˜ |

---

## ğŸ› ï¸ æ‰©å±•å…¶ä»–åœºæ™¯

å¦‚æœä½ æƒ³æ”¯æŒæ›´å¤šåœºæ™¯ï¼ˆå¢è‚Œã€è¥å…»å’¨è¯¢ç­‰ï¼‰ï¼Œå¯ä»¥åœ¨ `crewai_adapter_v2.py` é‡Œæ·»åŠ ï¼š

```python
def create_muscle_gain_workflow(crew, adapters, user_input):
    """å¢è‚Œåœºæ™¯å·¥ä½œæµ"""
    # ç±»ä¼¼å‡è„‚ï¼Œä½†çº¦æŸä¸åŒ
    ...

def create_nutrition_consultation_workflow(crew, adapters, user_input):
    """è¥å…»å’¨è¯¢åœºæ™¯å·¥ä½œæµ"""
    ...
```

ç„¶ååœ¨ `crewai_api_v2.py` çš„ `process_request` é‡Œæ ¹æ® `goal_type` è°ƒç”¨ä¸åŒçš„ workflowã€‚

---

## âœ… æ€»ç»“

ç°åœ¨è¿™å¥—ç³»ç»Ÿæ˜¯**çœŸæ­£çš„ CrewAI æ¡†æ¶**ï¼š

1. âœ“ ä½¿ç”¨å®˜æ–¹ CrewAI çš„ Agent / Task / Crew / Process
2. âœ“ æ¯ä¸ª BaseAgent çš„ä¸šåŠ¡é€»è¾‘è¢«åŒ…è£…æˆå·¥å…·
3. âœ“ å¤šæ­¥å·¥ä½œæµï¼Œæ˜¾å¼ä¾èµ–å…³ç³»
4. âœ“ Agent ä¹‹é—´äº’ç›¸æ ¡éªŒå’Œçº¦æŸ
5. âœ“ è§„åˆ™é€»è¾‘ + LLM æ¨ç†åŒé‡ä¿éšœ
6. âœ“ å¤§å¹…æå‡å‡†ç¡®ç‡å’Œå¯æ§æ€§

ä½ ç°åœ¨å¯ä»¥æ”¾å¿ƒåœ°è¯´ï¼š**"æˆ‘ç”¨çš„æ˜¯çœŸæ­£çš„ CrewAI æ¡†æ¶"**ï¼
